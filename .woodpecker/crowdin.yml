when:
  event: [push, cron]
  branch: develop

pipeline:
  upload:
    image: git.lcomrade.su/root/drone-crowdin-v2
    settings:
      crowdin_key:
        from_secret: crowdin_key
      project_id: 553341
      target: upload
      upload_files: {"internal/web/data/locale/en.locale": "en.ini"}
    when:
      event: push
      path: ["internal/web/data/locale/*", ".woodpecker/crowdin.yml"]

  download:
    image: git.lcomrade.su/root/drone-crowdin-v2
    settings:
      crowdin_key:
        from_secret: crowdin_key
      project_id: 553341
      target: download
      download_to: internal/web/data/locale/
      #download_skip_untranslated_strings: true
      download_skip_untranslated_files: true
      #download_export_approved_only: false
    when:
      event: cron

  push:
    image: appleboy/drone-git-push
    settings:
      author_email: "translatebot@lcomrade.su"
      author_name: Translate [Bot]
      branch: develop
      commit: true
      commit_message: "[skip ci] Updated translations"
      remote: "git@git.lcomrade.su:root/lenpaste.git"
      ssh_key:
        from_secret: ci_ssh_key
    when:
      event: cron
